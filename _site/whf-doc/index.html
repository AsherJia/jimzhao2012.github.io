<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         jimzhao
    -->
    <meta charset="utf-8" />
    <title>Hybrid framework | jimzhao.com</title>
    <meta name="author" content="jimzhao" />
    <meta name="description" content="jimzhao's doc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>

      <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="/assets/js/html5shiv.js"></script>
      <script src="/assets/js/respond.min.js"></script>
    <![endif]-->
</head>
<script type="text/javascript">

String.prototype.endWith = function(oString){  
    var reg = new RegExp(oString+"$");  
    return reg.test(this);     
};

$(document).ready(function(){
    var href = window.location.href;
    $("a#doc").parent().attr("class","");
    $("li#test").attr("class","");

    if (href.endWith("index.html")) {
        $("a#home").parent().attr("class","active");
    }
    else if (href.endWith("/test-manual/")) {
        $("li#test").attr("class","active");
    } 
    else if (href.endWith("/doc-schema/")) {
        $("li#api").attr("class","active");
    }
    else {
       var isWHFDoc = false;
       if (href.endWith("/doc-description/")) {
            isWHFDoc = true;
        }
        else if (href.endWith("/doc-entry/")) {
            isWHFDoc = true;
        } 
        else if (href.endWith("/doc-learning/")) {
            isWHFDoc = true;
        } 
        else if (href.endWith("/doc-debug/")) {
            isWHFDoc = true;
        } 
        else if (href.endWith("/doc-faq/")) {
            isWHFDoc = true;
        }
        else if (href.endWith("/doc-api/")) {
            isWHFDoc = true;
        }
        if (isWHFDoc) {
            $("a#doc").parent().attr("class","active");
        }
    }
});

function dismissTabActive() {
     $("a#doc").parent().attr("class","");
     $("li#test").attr("class","");
     $("li#api").attr("class","");
};

$("a#atest").click(function(){
    $("a#atest").parent().attr("class","active");
});

$("a#urlschema").click(function(){
    $("a#urlschema").parent().attr("class","active");
});

$("a#api").click(function(){
    $("a#api").parent().attr("class","active");
});

</script>

<style type="text/css">
.navbar-default .navbar-nav > .active > a,
.navbar-default .navbar-nav > .active > a:hover,
.navbar-default .navbar-nav > .active > a:focus {
  color: blue;
  font-size: 16px;
/*  font-weight: bold;
*/  background-color: #e7e7e7;
}

.navbar-default .navbar-nav > li > a {
  color: #777777;
  font-size: 16px;
/*  font-weight: bold;
*/}

</style>
<body>

  <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ctrip Hybrid Doc</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a class="ttaa"  id="doc" href="/doc-description/">开发文档</a></li>
            
            <li id="test" class="dropdown">
              <a onClick="dismissTabActive()" href="#" class="dropdown-toggle" data-toggle="dropdown">测试<b class="caret"></b></a>
              <ul class="dropdown-menu">
                  <li><a href="/test-manual/">手动测试</a></li>
                  <li><a target="_blank" href="/qunit/a.html">Qunit自动化测试</a></li>
              </ul>
            </li>

            <li id="api" class="dropdown">
              <a onClick="dismissTabActive()" href="#" class="dropdown-toggle" data-toggle="dropdown">Api文档<b class="caret"></b></a>
              <ul class="dropdown-menu">
                  <li><a href="/doc-schema/">URL Schema Doc</a></li>
                  <li><a href="/api/" target="_blank" >JS API Doc</a></li>    
              </ul>
            </li>

            <li class="dropdown">
              <a id="download" onClick="dismissTabActive()" href="#" class="dropdown-toggle" data-toggle="dropdown">源码下载<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/code/demo.zip">Demo下载</a></li>
                <li><a href="/code/bridge.js.zip">JSLib下载</a></li>
                <li><a href="/code/bridge.min.zip">JSLib 压缩版下载</a></li>
              </ul>
            </li>

            <li id="install" class="dropdown">
              <a onClick="dismissTabActive()" href="#" class="dropdown-toggle" data-toggle="dropdown">App安装<b class="caret"></b></a>
              <ul class="dropdown-menu">
                  <li><a href="itms-services://?action=download-manifest&url=http://210.13.100.191:7001/qunit/cw_install.plist">iOS App安装</a></li>
                  <li><a onClick="alert('Android App安装将在稍后支持。');" target="_blank" >Android App安装</a></li>    
              </ul>
            </li>

          </ul>
        </div>
      </div>
    </div>

   <!--  <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">BeiYuu</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/beiyuu/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/beiyuu/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
            <a href="http://instagram.com/beiyuu/" target="_blank" style="text-align:right"><img src="http://d36xtkk24g8jdx.cloudfront.net/bluebar/00c6602/images/ico/favicon.ico" alt="" width="22"/></a>
        </div>
    </div> -->


    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }

    #content {width:1060px;margin:90px auto 60px; margin-left:40px;margin-top:40px; min-height:400px;height:auto !important;height:400px; }
    .active { background:#ccc;}
</style>

<script type="text/javascript">
$(document).ready(function(){
    var href = window.location.href;
    $("li#doc-description").attr("class","");
    $("li#doc-learning").attr("class","");
    $("li#doc-entry").attr("class","");
    $("li#doc-debug").attr("class","");
    $("li#doc-faq").attr("class","");
    $("li#doc-api").attr("class","");

    var val = "active";
    if (href.endWith("/doc-description/")) {
        $("li#doc-description").attr("class",val);
    }
    else if (href.endWith("/doc-entry/")) {
        $("li#doc-entry").attr("class",val);
    } 
    else if (href.endWith("/doc-learning/")) {
        $("li#doc-learning").attr("class",val);
    } 
    else if (href.endWith("/doc-debug/")) {
        $("li#doc-debug").attr("class",val);
    } 
    else if (href.endWith("/doc-faq/")) {
        $("li#doc-faq").attr("class",val);
    }
     else if (href.endWith("/doc-api/")) {
        $("li#doc-api").attr("class",val);
    }
});
</script>
<div class="container" style="width:120px; height:100%; position:fixed;">
     <div class="row"> 
       <div class="span3">
          <div class="well" style="padding:10px 0;margin-top:0px;">
             <ul class="nav nav-list">
                <li class="divider"></li>
                <li id="doc-description" class="active"><a href="/doc-description/"><i class="icon-white icon-home"></i>1.平台描述</a></li>
                <li id="doc-entry" ><a href="/doc-entry/"><i class="icon-flag"></i>2.快速入门</a></li>
                <li id="doc-learning"><a href="/doc-learning/"><i class="icon-flag"></i>3.数据交互</a></li>
                <li id="doc-debug"><a href="/doc-debug/"><i class="icon-folder-open"></i>4.打包&更新</a></li>
                <li id="doc-faq"><a href="/doc-faq/"><i class="icon-file"></i>5.常见问题</a></li>
                <li id="doc-api"><a href="/doc-api/"><i class="icon-user"></i>6.API文档</a></li>
             </ul>
          </div>
       </div>
     </div>
</div>


<div id="content">
    <div class="entry">
<!--         <h1 class="entry-title"><a href="/whf-doc" title="Hybrid framework">Hybrid framework</a></h1>
        <p class="entry-date">2013-12-25</p> -->


        <p><img src="/images/Mou_128.png" alt="Mou icon"></p>

<h2 id="toc_0">1.平台概述</h2>

<h3 id="toc_1">1.1. 介绍</h3>

<p>WHF移动开发平台是基于HTML5技术的跨平台快速开发解决方案。开发者利用HTML5+CSS3+JavaScript技术可以快速的开发与本地应用相媲美的应用，并可以和ctrip现有账号/业务系统完美结合。 </p>

<h3 id="toc_2">1.2. 组成部分</h3>

<p><code>1. WHF基础库中间件；</code><br/>
提供平台接口库，对一些常用的基础功能进行包装，并提供JS库给开发者使用；<br/></p>

<p><code>2.  WHF-Ctrip业务相关中间件；</code><br/>
提供接口，对Ctrip业务相关功能(例如用户相关)进行包装，并提供JS库给开发者使用；<br/></p>

<p><code>3. URL Scheme；</code><br/>
提供文档，开发者按照文档拼装ctrip格式URL schema，可以跳转到ctrip app的各个页面；<br/></p>

<p><code>4. UI方案支持(TODO)</code><br/>
基于现有UI方案(比如JQuery Mobile UI)，封装符合ctrip UI风格的控件库，方便开发者使用；<br/></p>

<h3 id="toc_3">1.3. 平台特色</h3>

<ul>
<li>支持Webapp包自动/手动在线更新</li>
<li>支持多窗口webapp</li>
<li>支持本地web页面和站点页面无缝跳转</li>
<li>无缝整合ctrip账号体系+业务体系</li>
<li>iOS&android跨平台支持，且体验一致</li>
<li>支持打包到本地和HTTP站点两种模式的webapp</li>

</ul>
    

<h2 id="toc_4">2.快速入门</h2>

<p>下面以一个简单的Hello world页面介绍框架的使用。<br/>
1.创建文件夹 hello;<br/>
2.将bridge.js复制到该文件夹;<br/></p>

<p><img src="/images/hello.png" alt="folder_png"><br/></p>

<p>3.创建index.html,并import bridge.js;<br/></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;script type=&quot;text/javascript&quot; src=&quot;bridge.js&quot;&gt;&lt;/script&gt;
</code></pre></div>
<p>4.在页面加入2个测试链接</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;ul class=&quot;ul1&quot;&gt;
&lt;li class=&quot;li2&quot;&gt;&lt;aonclick=&quot;javscript:CtripUser.app_member_login()&quot;&gt;登录&lt;/a&gt;&lt;/li&gt;
&lt;br/&gt;
&lt;br/&gt; 
&lt;li class=&quot;li2&quot;&gt;&lt;a href=&quot;ctrip://wireless/InlandHotel?hotelId=87120&amp;cityId=2&amp;checkInDate=201301220&amp;checkOutDate=20131221&quot;&gt;进入酒店详情页&lt;/a&gt;&lt;/li&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;/ul&gt;
</code></pre></div>
<p>4.在index.html页面添加函数 app.callback();<br/></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;script type=&quot;text/javascript&quot;&gt;
var app = {
    callback: function(json_obj) 
    {
        var tagname = json_obj.tagname;

        if (tagname == &#39;web_view_finished_load&#39;) 
        {
            //webview载入完成，刷新顶部条
            var nav_bar_config_json = {&quot;left&quot;:[{&quot;tagname&quot;:&quot;back&quot;}], &quot;center&quot;:[{&quot;tagname&quot;:&quot;title&quot;,&quot;value&quot;:&quot;Hello, H5&quot;}], &quot;right&quot;:[{&quot;tagname&quot;:&quot;login&quot;,&quot;value&quot;:&quot;登录&quot;}]};
            var json_str = JSON.stringify(nav_bar_config_json);
            //调用刷新顶部条API
            CtripUtil.app_refresh_nav_bar(json_str);
        }
        else if (tagname == &quot;back&quot;)
        {
            //处理顶部栏的返回按钮
            History.back();
            return true;
        }
        else if (tagname == &quot;login&quot;) 
        {
            //处理登录事件
            alert(&quot;用户登录完成:&quot;+JSON.stringify(json_obj));
        }
    }
};

&lt;/script&gt;
</code></pre></div>
<p>5.将Hello文件夹zip，然后build到客户端测试，界面显示如下：</p>

<p><img src="/images/demo.png" alt="demo.png"></p>

<p>6.下面是整个页面文件的代码</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
  &lt;meta http-equiv=&quot;Content-Style-Type&quot; content=&quot;text/css&quot;&gt;
  &lt;title&gt;Hello, world&lt;/title&gt;
   &lt;meta name=&quot;viewport&quot; content=&quot;initial-scale = 1.0,maximum-scale = 1.0&quot; /&gt;
  &lt;meta name=&quot;CocoaVersion&quot; content=&quot;1138.23&quot;&gt;
  &lt;style type=&quot;text/css&quot;&gt;
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Helvetica; min-height: 16.0px}
    li.li2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Helvetica; color: #2567e8}
    li.li3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Helvetica}
    ul.ul1 {list-style-type: disc}
  &lt;/style&gt;

  &lt;script type=&quot;text/javascript&quot; src=&quot;bridge.js&quot;&gt;&lt;/script&gt;

  &lt;script type=&quot;text/javascript&quot;&gt;

  var app = {
        callback: function(json_obj) {
          var tagname = json_obj.tagname;
          if (tagname == &#39;web_view_finished_load&#39;) { 
              //webview载入完成，刷新顶部条
              var nav_bar_config_json = {&quot;left&quot;:[{&quot;tagname&quot;:&quot;back&quot;}], &quot;center&quot;:[{&quot;tagname&quot;:&quot;title&quot;,&quot;value&quot;:&quot;Hello, World&quot;}], &quot;right&quot;:[{&quot;tagname&quot;:&quot;login&quot;,&quot;value&quot;:&quot;登录&quot;}]};
              var json_str = JSON.stringify(nav_bar_config_json);
              CtripUtil.app_refresh_nav_bar(json_str);
          } 
          else if (tagname == &quot;back&quot;) {
            if (history.length == 0) {
              CtripUtil.app_back_to_last_page();
            } else {
              History.back();
            }
            return true;
          }
          else if (tagname == &quot;login&quot;) {
            //处理登录事件
            alert(&quot;用户登录完成:&quot;+JSON.stringify(json_obj));
          }
        }
    };

  &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;br&gt;&lt;/p&gt;
&lt;ul class=&quot;ul1&quot;&gt;
  &lt;li class=&quot;li2&quot;&gt;&lt;a onclick=&quot;javscript:CtripUser.app_member_login()&quot;&gt;登录&lt;/a&gt;&lt;/li&gt;
  &lt;br/&gt;
  &lt;br/&gt; 
  &lt;li class=&quot;li2&quot;&gt;&lt;a href=&quot;ctrip://wireless/InlandHotel?hotelId=87120&amp;cityId=2&amp;checkInDate=201301220&amp;checkOutDate=20131221&quot;&gt;进入酒店详情页&lt;/a&gt;&lt;/li&gt;
  &lt;br/&gt;
  &lt;br/&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
<h2 id="toc_5">3.开发文档</h2>

<h3 id="toc_6">3.1 使用流程</h3>

<p>下图是H5和Native调用的流程图</p>

<p><img src="/images/process.png" alt="调用流出"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">1. App进入H5模块页面，LoadWebView;
2. Webview加载完成(WebViewDidFinishedLoad)，通过app.callback()回调tagname=web_view_finish_load给H5页面;
3. H5页面可以调用JS Lib中的所有API，例如app_login();
4. JS Lib会通过plugin方式调用native的login函数;
5. native的login函数执行完成，回调给JS Lib;
6. JS Lib将用户登录的数据回调给H5;
</code></pre></div>
<p>说明：由于JS Lib函数调用的时候，H5页面可能尚未加载完成，因此必须等收到web_view_finish_load的回调之后;</p>

<h3 id="toc_7">3.2 全局数据结构</h3>

<p>app.callback(jsonParam)函数<br/></p>

<p>app 主动调用和回调H5页面，都是通过该函数完成。因此，<code>所有的H5页面，都需要实现该函数</code>。<br/></p>

<p>jsonParam为JSON对象类型,其内部参数格式如下:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
    tagname:&quot;xxxxx&quot;,


    param:{key1:&quot;xxx&quot;,key2:&quot;xxxa&quot;}

}

//tagname:参数类型为字符串, 回调的事件名,不能为空;
//param: 参数类型为JSON对象, 调用/回调给H5的数据,该字段允许为空;
</code></pre></div>
<h3 id="toc_8">3.3.    数据交互</h3>

<p>总共分2部分，app调用H5，H5调用App</p>

<h4 id="toc_9">3.3.1. App调用H5</h4>

<p>App调用H5分为两种，App主动调用H5，App回调H5.</p>

<p><code>App主动调用H5</code></p>

<p>A.标识H5页面状态的固定回调</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">1. H5页面加载完成，通知H5;
2. H5页面激活，从后台切入前台，通知H5;
3. H5页面加载完成后，切换到其它页面之后，回退回来，再次显示时候，通知H5;
</code></pre></div>
<p>B.H5页面顶部导航栏上的按钮事件</p>

<p>H5页码的顶部导航栏是由native实现，导航栏上面的按钮，文字，均由H5控制(有JS函数可以设置顶部导航栏内容)，因此顶部导航栏的按钮也算是H5页面的一部分，顶部按钮事件也应由H5控制； </p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">1.左侧返回按钮
用户点击返回，app会调用H5的app.callback({tagname:&#39;back&#39;}), H5返回true，则使用H5的返回，否则app会处理该返回事件；
2.右侧内容
右侧按钮点击，app会调用H5的app.callback({tagname:&#39;xxxx&#39;}),tagname为H5设置的该按钮的属性;
</code></pre></div>
<p><code>App回调H5</code></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">H5调用JS Lib的函数之后，如果有数据需要返回给H5的，app会通过调用H5的app.callback({tagname:&#39;xxxx&#39;, param:{key1:&quot;xxxx&quot;, key2:&quot;xxxxx&quot;}}),将数据返回给H5

具体的各个API回调的参数格式，请参考后文[API文档];
</code></pre></div>
<h4 id="toc_10">3.3.2.  H5调用App</h4>
<div class="highlight"><pre><code class="text language-text" data-lang="text">1.H5调用JS Lib中的API
    a.通用功能，H5页面调用JS库中的相关JS API. 具体API定义参考后面的API手册;
    b.业务相关, JS Lib中对部分有返回值的业务模块的API进行封装，例如会员登录/注册，支付业务;



2.H5拼装ctrip:协议的URL Schema做跳转
   通过URL schema方式调用,拼装完成后，调用JS Lib里面的CtripUtil.app_open_url()函数,跳转到各个app页面。
   具体的URL Schema定义列表参考后面的URL Schema手册；
</code></pre></div>
<h3 id="toc_11">3.4.    调试</h3>

<p>下文以上面demo中为例，描述了怎样将该webapp放入到app中调试<br/></p>

<ul>
<li>1.点击安装<a href="itms-services://?action=download-manifest&url=http://210.13.100.191:7001/qunit/cw_install.plist">携程旅游App开发版</a></li>
<li>2.将html文件存储为home.html. 然后将home.html, bridge.js放入文件夹demo,使用zip压缩demo文件夹，得到demo.zip；</li>
<li>3.iOS通过<a targe="_blank" href="http://support.apple.com/kb/HT4094?viewlocale=zh_CN&locale=zh_CN">iTunes文件共享</a>将demo.zip文件copy到携程旅行的文稿目录;</li>
<img src="/images/file_sharing.jpg" width="620"></img>
<li>4.进入H5开发设置页面。步骤：进入用车－》点击底部H5设置按钮即可</li>
<li>5.在下图的页面中，输入新增模块的相对路径，如zip包解压之后为demo，首页地址为demo/home.index.html</li>
<img src="/images/input.jpg"></img>
<li>6.点击新加入的测试入口进入测试；</li>
<img src="/images/input_done.jpg"></img>
<li>7.测试页面内容显示如下；</li>
<img src="/images/demo.png"> </img>
</ul>   

<p>在H5开发设置页面里面，还有2个按钮。<br/>
1.更新日志，点击可以查看webapp自动更新的每一个步骤；<br/>
2.开发首页，即该开发站点的链接，内部有JS Lib自动化测试入口和手动测试入口；<br/></p>

<p><img src="/images/debug_2.jpg" alt="debug_log"></p>

<p>上图显示了日志查看功能；</p>

<h2 id="toc_12">4.    打包&amp;更新</h2>

<p>该部分的内容都是将webapp包下载到app 本地，然后打开的方式。<br/>
对于所有的在线HTTP站点页面，保持URL地址不变，站点随时动态更新即可；<br/></p>

<h3 id="toc_13">4.1  目录结构</h3>

<p>app内部有一个指定的webapp目录，所有的hybrid app都是在这个目录下面，具体参考下图。</p>

<p><img src="/images/wb_struct.png" alt="icon webapp struct"></p>

<p>开发者开发的app最终都会被下载保存到该目录，因此不能与已经存在打目录重复。在开发者站点有入口可供查询。</p>

<h3 id="toc_14">4.2  更新机制</h3>

<p>1.app启动时候，会做增量更新，服务器端告诉app，是否有H5包需要更新；<br/>
2.如果有H5包需要更新，app会去获取所有需要更新的H5包相关信息；<br/></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">H5包即为开发好的webapp的zip包，从服务器获取的主要信息有：
1.下载地址;
2.包名,包名为解压到webapp之后的名字;
3.包的md5 hash值，32位，大写;
4.包的优先级，优先级从0开始，数字越小，优先级越高
</code></pre></div>
<p>3.app根据包的优先级下载这些需要更新或者安装的H5包；</p>

<h3 id="toc_15">4.3  提交方案</h3>

<p>1.准备开发好的webapp的zip包，提供以下信息给服务器端；</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">1.下载地址;
2.包名,包名为解压到webapp之后的名字;
3.包的md5 hash值，32位，大写;
4.包的优先级，优先级从0开始，数字越小，优先级越高
</code></pre></div>
<p>2.联系App team，在App里面添加该webapp的入口；<br/>
3.或者直接通过其它H5 webapp/广告跳转到该webapp；</p>

<h2 id="toc_16">5.    常见问题FAQ</h2>

<p>1.何时可以调用JS Lib里面的API？<br/></p>

<p>答：收到app回调给H5页面web_view_finished_load的回调之后可以调用；<br/><br/></p>

<p>2.Webview缓存为何无法清空？<br/></p>

<p>答：为解决该问题，请点击H5页面左下角的刷新按钮，手动强制刷新。<br/><br/></p>

<p>3.为什么会出现白屏的情况？<br/></p>

<p>答：出现白屏的情况有很多，归纳下来<br/></p>

<p>a.程序bug，比如页面有网络请求，请求完成之后，页面才渲染，这个时候，如果网络状况不好，就会出现白屏,解决方面，H5页面不要用阻塞加载，不要去等待网络请求数据返回；<br/></p>

<p>b.app的webview有bug，这个是系统控件的不稳定性导致的，测试过程中出现比例很小；<br/></p>

<p>c.android上面，某些URL(比如URL带＃)无法调整，出现页面无法打开的错误白屏页面，这个是由于在某些2.3固件ROM上出现的问题，对特殊URL解析失败；<br/><br/></p>

<p>4.增量更新包无法更新成功？<br/></p>

<p>答：因为更新逻辑比较复杂，请查看H5设置页面里面的更新日志，有详细的纪录，所有的更新步骤都有<br/></p>

<h2 id="toc_17">6.    API手册</h2>

<p><nav>
 <li><a href="out/index.html">JS API Doc</a></li>
 <li><a href="urlschema.html">URL shcema Doc</a></li>
</nav></p>

<p>app主动回调H5页面</p>

<table><thead>
<tr>
<th>回调tagname</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>web_view_finished_load</td>
<td>H5页面加载完成</td>
</tr>
<tr>
<td>web_view_did_appear</td>
<td>H5页面加载完成后，切换到其它页面之后，回退回来，再次显示时候，通知H5。可能会带有上个H5页面的参数</td>
</tr>
<tr>
<td>web_view_did_active</td>
<td>H5页面激活，从后台切入前台，通知H5</td>
</tr>
<tr>
<td>back</td>
<td>用户点击导航栏左上角的返回按钮，H5页面对该tagname要有返回值，返回true，表示H5页面已经处理返回事件，否则会调用native的返回事件</td>
</tr>
</tbody></table>

<h2 id="toc_18">7.TODO List</h2>

<p><code>1.UI框架</code></p>

<p>基于JQuery Mobile 开发UI框架</p>

<p><code>2.开发框架原则确定</code></p>

<p>1.业务无关，通用功能，JS API实现；比如文件读写<br/>
2.ctrip业务相关，H5调用之后，必须返回数据给H5页面的，JS API实现；比如登录／支付<br/>
3.ctrip业务相关，H5调用之后，无需返回数据给H5页面的，URL Schema实现；比如酒店详情页 <br/></p>

<p><code>3.JS API的整理和完善:公共API＋Ctrip业务API</code></p>

<p>基础框架(公共API)<br/>
参考appcan，整理出基础模块API</p>

<table><thead>
<tr>
<th>定义</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>ct_CONSTANT</td>
<td>定义一组常量</td>
</tr>
<tr>
<td>ct_ErrorCode</td>
<td>定义一组错误代码</td>
</tr>
<tr>
<td>ct_Call</td>
<td>电话相关API</td>
</tr>
<tr>
<td>ct_Camera</td>
<td>相机调用</td>
</tr>
<tr>
<td>ct_ImagePicker</td>
<td>读写图片</td>
</tr>
<tr>
<td>ct_Clipboard</td>
<td>粘贴板读写</td>
</tr>
<tr>
<td>ct_Contact</td>
<td>联系人选取/新增</td>
</tr>
<tr>
<td>ct_DataBaseMgr</td>
<td>KV数据库读写</td>
</tr>
<tr>
<td>ct_Device</td>
<td>设备硬件相关信息</td>
</tr>
<tr>
<td>ct_DownloaderMgr</td>
<td>下载控件</td>
</tr>
<tr>
<td>ct_Email</td>
<td>email控件调用</td>
</tr>
<tr>
<td>ct_FileMgr</td>
<td>文件管理</td>
</tr>
<tr>
<td>ct_Location</td>
<td>定位管理</td>
</tr>
<tr>
<td>ct_Log</td>
<td>log读写</td>
</tr>
<tr>
<td>ct_Share</td>
<td>分享控件</td>
</tr>
<tr>
<td>ct_SMS</td>
<td>短信调用</td>
</tr>
<tr>
<td>Ct_Application</td>
<td>应用相关信息，沙盒目录信息</td>
</tr>
</tbody></table>

<p>ctrip业务框架(Ctrip业务API)<br/>
整理出那些业务模块是需要包装给H5使用的，然后抽象并提供接口；</p>

<table><thead>
<tr>
<th>定义</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>ct_User</td>
<td>用户登录注册</td>
</tr>
<tr>
<td>ct_Pay</td>
<td>支付控件</td>
</tr>
</tbody></table>


     <!--    <div id="disqus_container">
            <a href="#" class="comment" onclick="return false;">点击查看评论</a>
            <div id="disqus_thread"></div>
        </div> -->
    </div>

   <!--  <div class="sidenav">
        <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=75&fansRow=2&ptype=1&speed=0&skin=5&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=1855270953&verifier=375b89d6&dpc=1"></iframe>
    </div> -->
<!-- 
    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
            <li><a href="/jekyll-install">安装jekyll</a></li>
        
        </ul>

        <h2>Opinion</h2>
        <ul class="artical-list">
        
        </ul>

        <h2>Project</h2>
        <ul class="artical-list">
        
        </ul>
    </div>
</div> -->

<script src="/js/post.js" type="text/javascript"></script>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--************* 再推荐下我的第一篇博客哦~~ ****************-->
    <!--*********************************************************-->

    <script src="/js/bootstrap.min.js"></script>
  <!--   <div class="hide">
        <script type="text/javascript" src="http://js.tongji.linezing.com/2727758/tongji.js"></script>
        <noscript><a href="http://www.linezing.com"><img src="http://img.tongji.linezing.com/2727758/tongji.gif"/></a></noscript>
    </div> -->

</body>
</html>
